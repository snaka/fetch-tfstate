# fetch-tfstate

Fetch Terraform Cloud tfstate on GitHub Actions

## Motivation

Deployment tools around ECS such as [ecspresso](https://github.com/kayac/ecspresso) and [ecschedule](https://github.com/Songmu/ecschedule) can be conveniently used in conjunction with Terraform using tfstate.

However, if you are using Terraform Cloud and the repository that manages the terraform code is separated from the application code to be deployed, it is a little troublesome to get tfstate.

To solve this problem, this Action will download the latest tfstate of the specified workflow from Terraform Cloud on your behalf.

## Usage

in your workflow yaml file

```yaml
jobs:
  example:
    runs-on: ubuntu-latest
    steps:
      - id: fetch-tfstate
        uses: snaka/fetch-tfstate@v1-beta
        with:
          terraform-cloud-token: ${{ secrets.TERRAFORM_CLOUD_TOKEN }}
          workspace-id: 'ws-xxxxxxxxxxxxxxx'
          path-to-tfstate: ${{ github.workspace }}/terraform.tfstate  # optional
      - show tfstate file
        run: echo ${{ steps.fetch-tfstate.outputs.tfstate }}
```

## Inputs

| Name                  | Description                    | Required | Default                                           |
| --------------------- | ------------------------------ | -------- | ------------------------------------------------- |
| terraform-cloud-token | Terraform Cloud API token      | true     | -                                                 |
| workspace-id          | Terraform Cloud workspace name | true     | -                                                 |
| path-to-tfstate       | Path to tfstate file           | false    | Random filename generated by the `mktemp` command |

## Outputs

| Name    | Description                     |
| ------- | ------------------------------- |
| tfstate | Path to downloaded tfstate file |
